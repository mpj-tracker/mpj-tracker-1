<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Supabase Auth Tester</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 2rem; }
    .row { display: flex; gap: .5rem; align-items: center; margin: .5rem 0; }
    input { padding: .5rem .6rem; border: 1px solid #ddd; border-radius: 8px; width: 260px; }
    button { padding: .5rem .8rem; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; }
    .ok { color: #0a7a3a; font-weight: 700; }
    .bad { color: #b00020; font-weight: 700; }
    code { background: #f6f8fa; padding: .15rem .35rem; border-radius: 6px; }
    .box { border: 1px solid #eee; border-radius: 12px; padding: 1rem; max-width: 640px; }
    .muted { color:#666; }
  </style>
</head>
<body>
  <h1>Supabase Auth – Minimal Tester</h1>

  <div class="box">
    <div class="row">
      <strong>Status:</strong>
      <span id="status" class="bad">Signed out</span>
    </div>
    <div class="row"><small class="muted">User ID:</small> <code id="uid">—</code></div>
    <div class="row"><small class="muted">Email:</small> <code id="uemail">—</code></div>
  </div>

  <h3>Sign up / Sign in</h3>
  <div class="row">
    <input id="email" type="email" placeholder="email@example.com" />
    <input id="pw" type="password" placeholder="password" />
  </div>
  <div class="row">
    <button id="signup">Sign Up</button>
    <button id="login">Log In</button>
    <button id="logout">Log Out</button>
  </div>

  <pre id="log" class="box" style="white-space:pre-wrap; margin-top:1rem; background:#fafafa"></pre>

  <script>
    // 1) Supabase client
    const SUPABASE_URL = "https://zpnqruthpknncpiiztxf.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpwbnFydXRocGtubmNwaWl6dHhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NjM4NzQsImV4cCI6MjA3NDAzOTg3NH0.-9ReQMcI2izlwEP72ya6KXqnIgmBnH5b_wMRtwcFp-4";
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // 2) UI refs
    const statusEl = document.getElementById('status');
    const uidEl = document.getElementById('uid');
    const emailEl = document.getElementById('uemail');
    const logEl = document.getElementById('log');
    const emailInp = document.getElementById('email');
    const pwInp = document.getElementById('pw');
    const signupBtn = document.getElementById('signup');
    const loginBtn = document.getElementById('login');
    const logoutBtn = document.getElementById('logout');

    function setState(session){
      const user = session?.user || null;
      if(user){
        statusEl.textContent = "Signed in";
        statusEl.className = "ok";
        uidEl.textContent = user.id;
        emailEl.textContent = user.email || "(no email)";
      }else{
        statusEl.textContent = "Signed out";
        statusEl.className = "bad";
        uidEl.textContent = "—";
        emailEl.textContent = "—";
      }
    }
    function log(msg){ logEl.textContent = `${new Date().toLocaleTimeString()} ${msg}\n` + logEl.textContent; }

    // 3) Initial session & auth state listener
    (async ()=>{
      const { data } = await sb.auth.getSession();
      setState(data.session);
      log("Initial session loaded.");
    })();

    sb.auth.onAuthStateChange(async (evt, _session)=>{
      const { data } = await sb.auth.getSession(); // always re-fetch
      setState(data.session);
      log(`Auth state: ${evt}`);
    });

    // 4) Buttons
    signupBtn.onclick = async ()=>{
      const email = (emailInp.value||"").trim();
      const pw = pwInp.value || "";
      if(!email || !pw){ alert("Enter email & password"); return; }
      const { data, error } = await sb.auth.signUp({ email, password: pw });
      if(error){ alert(error.message); log(`SignUp error: ${error.message}`); return; }
      log("SignUp OK. (If your project requires email confirmation, check inbox.)");
    };

    loginBtn.onclick = async ()=>{
      const email = (emailInp.value||"").trim();
      const pw = pwInp.value || "";
      if(!email || !pw){ alert("Enter email & password"); return; }
      const { data, error } = await sb.auth.signInWithPassword({ email, password: pw });
      if(error){ alert(error.message); log(`Login error: ${error.message}`); return; }
      log("Login OK.");
    };

    logoutBtn.onclick = async ()=>{
      const { error } = await sb.auth.signOut();
      if(error){ alert(error.message); log(`Logout error: ${error.message}`); return; }
      log("Logged out.");
    };
  </script>
</body>
</html>
