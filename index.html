<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MPJ Tracker</title>

  <!-- Favicon / icons (optional) -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <meta name="theme-color" content="#0b5f3b" />

  <!-- Supabase library + Auth UI web component -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script type="module" src="https://unpkg.com/@supabase/auth-ui@0.5.8/dist/web/index.js"></script>

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; }
    .wrap { max-width: 900px; margin: 2rem auto; padding: 1rem; }
    .hidden { display: none; }
    .bar { display:flex; align-items:center; gap:.5rem; }
    .brand { font-weight: 700; color:#0b5f3b; }
    button { padding:.5rem 1rem; border-radius:8px; border:1px solid #ddd; cursor:pointer; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <span class="brand">MPJ Tracker</span>
      <span id="status" style="margin-left:auto;color:#666;">Connectingâ€¦</span>
    </div>

    <!-- Auth UI (shown when logged OUT) -->
    <div id="auth-box">
      <!-- This tag renders Supabase's auth forms (email+password by default) -->
      <supabase-auth
        id="auth"
        providers="email"
        appearance='{"style":{"button":{"borderRadius":"8px"}}}'>
      </supabase-auth>
    </div>

    <!-- App UI (shown when logged IN) -->
    <div id="app" class="hidden">
      <p>âœ… Logged in. Build the app UI here.</p>
      <button id="logout">Log out</button>
    </div>
  </div>

  <script type="module">
    // ðŸ”§ EDIT THESE TWO:
    const SUPABASE_URL = "https://zpnqruthpknncpiiztxf.supabase.co/";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpwbnFydXRocGtubmNwaWl6dHhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NjM4NzQsImV4cCI6MjA3NDAzOTg3NH0.-9ReQMcI2izlwEP72ya6KXqnIgmBnH5b_wMRtwcFp-4";

    // Create client and expose globally (handy if you add more files later)
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    window.supabaseClient = supabase;

    const authBox = document.getElementById('auth-box');
    const appBox = document.getElementById('app');
    const status = document.getElementById('status');
    const logout = document.getElementById('logout');

    // Render helper
    function render(session) {
      const loggedIn = !!session;
      status.textContent = loggedIn ? 'Signed in' : 'Signed out';
      authBox.classList.toggle('hidden', loggedIn);
      appBox.classList.toggle('hidden', !loggedIn);
    }

    // Listen for auth state changes
    supabase.auth.onAuthStateChange((_event, session) => render(session));

    // Initial session check
    (async () => {
      const { data } = await supabase.auth.getSession();
      render(data.session);
    })();

    // Logout
    logout.addEventListener('click', async () => {
      const { error } = await supabase.auth.signOut();
      if (error) alert('Logout error: ' + error.message);
    });
  </script>
</body>
</html>
